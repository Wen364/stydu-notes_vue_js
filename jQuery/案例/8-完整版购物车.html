<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        .car-header {
    padding: 20px 0;
}

.car-logo img {
    vertical-align: middle;
}

.car-logo b {
    font-size: 20px;
    margin-top: 20px;
    margin-left: 10px;
}

.cart-filter-bar {
    font-size: 16px;
    color: #E2231A;
    font-weight: 700;
}

.cart-filter-bar em {
    padding: 5px;
    border-bottom: 1px solid #E2231A;
}

.cart-thead {
    height: 32px;
    line-height: 32px;
    margin: 5px 0 10px;
    padding: 5px 0;
    background: #f3f3f3;
    border: 1px solid #e9e9e9;
    border-top: 0;
    position: relative;
}

.cart-thead>div,
.cart-item>div {
    float: left;
}

.t-checkbox,
.p-checkbox {
    height: 18px;
    line-height: 18px;
    padding-top: 7px;
    width: 122px;
    padding-left: 11px;
}

.t-goods {
    width: 400px;
}

.t-price {
    width: 120px;
    padding-right: 40px;
    text-align: right;
}

.t-num {
    width: 150px;
    text-align: center;
}

.t-sum {
    width: 100px;
    text-align: right;
}

.t-action {
    width: 130px;
    text-align: right;
}

.cart-item {
    height: 160px;
    border-style: solid;
    border-width: 2px 1px 1px;
    border-color: #aaa #f1f1f1 #f1f1f1;
    background: #fff;
    padding-top: 14px;
    margin: 15px 0;
}

.check-cart-item {
    background: #fff4e8;
}

.p-checkbox {
    width: 50px;
}

.p-goods {
    margin-top: 8px;
    width: 565px;
}

.p-img {
    float: left;
    border: 1px solid #ccc;
    padding: 5px;
}

.p-msg {
    float: left;
    width: 210px;
    margin: 0 10px;
}

.p-price {
    width: 110px;
}

.quantity-form {
    width: 80px;
    height: 22px;
}

.p-num {
    width: 170px;
}

.decrement,
.increment {
    float: left;
    border: 1px solid #cacbcb;
    height: 18px;
    line-height: 18px;
    padding: 1px 0;
    width: 16px;
    text-align: center;
    color: #666;
    margin: 0;
    background: #fff;
    margin-left: -1px;
}

.itxt {
    float: left;
    border: 1px solid #cacbcb;
    width: 42px;
    height: 18px;
    line-height: 18px;
    text-align: center;
    padding: 1px;
    margin: 0;
    margin-left: -1px;
    font-size: 12px;
    font-family: verdana;
    color: #333;
    -webkit-appearance: none;
}

.p-sum {
    font-weight: 700;
    width: 145px;
}


/* 结算模块 */

.cart-floatbar {
    height: 50px;
    border: 1px solid #f0f0f0;
    background: #fff;
    position: relative;
    margin-bottom: 50px;
    line-height: 50px;
}

.select-all {
    float: left;
    height: 18px;
    line-height: 18px;
    padding: 16px 0 16px 9px;
    white-space: nowrap;
}

.select-all input {
    vertical-align: middle;
    display: inline-block;
    margin-right: 5px;
}

.operation {
    float: left;
    width: 250px;
    margin-left: 40px;
}

.clear-all {
    font-weight: 700;
    margin: 0 20px;
}

.toolbar-right {
    float: right;
}

.amount-sum {
    float: left;
}

.amount-sum em {
    font-weight: 700;
    color: #E2231A;
    padding: 0 3px;
}

.price-sum {
    float: left;
    margin: 0 15px;
}

.price-sum em {
    font-size: 16px;
    color: #E2231A;
    font-weight: 700;
}

.btn-area {
    font-weight: 700;
    width: 94px;
    height: 52px;
    line-height: 52px;
    color: #fff;
    text-align: center;
    font-size: 18px;
    font-family: "Microsoft YaHei";
    background: #e54346;
    overflow: hidden;
}
    </style>
    <link rel="stylesheet" href="css/base.css">
    <script src="../jquery.min.js"></script>
</head>
<body>
    <div class="car-header">
        <div class="w">
            <div class="car-logo">
                <img src="img/logo.png" alt=""> <b>购物车</b>
            </div>
        </div>
    </div>

    </div>
    <div class="c-container">
        <div class="w">
            <div class="cart-filter-bar">
                <em>全部商品</em>
            </div>
            <!-- 购物车主要核心区域 -->
            <div class="cart-warp">
                <!-- 头部全选模块 -->
                <div class="cart-thead">
                    <div class="t-checkbox">
                        <input type="checkbox" name="" id="" class="checkall"> 全选
                    </div>
                    <div class="t-goods">商品</div>
                    <div class="t-price">单价</div>
                    <div class="t-num">数量</div>
                    <div class="t-sum">小计</div>
                    <div class="t-action">操作</div>
                </div>
                <!-- 商品详细模块 -->
                <div class="cart-item-list">
                    <div class="cart-item check-cart-item">
                        <div class="p-checkbox">
                            <input type="checkbox" name="" id="" checked class="s-checkbox">
                        </div>
                        <div class="p-goods">
                            <div class="p-img">
                                <img src="upload/p1.jpg" alt="">
                            </div>
                            <div class="p-msg">【5本26.8元】经典儿童文学彩图青少版八十天环游地球中学生语文教学大纲</div>
                        </div>
                        <div class="p-price">￥12.60</div>
                        <div class="p-num">
                            <div class="quantity-form">
                                <a href="javascript:;" class="decrement">-</a>
                                <input type="text" class="itxt" value="1">
                                <a href="javascript:;" class="increment">+</a>
                            </div>
                        </div>
                        <div class="p-sum">￥12.60</div>
                        <div class="p-action"><a href="javascript:;">删除</a></div>
                    </div>
                    <div class="cart-item">
                        <div class="p-checkbox">
                            <input type="checkbox" name="" id="" class="s-checkbox">
                        </div>
                        <div class="p-goods">
                            <div class="p-img">
                                <img src="upload/p2.jpg" alt="">
                            </div>
                            <div class="p-msg">【2000张贴纸】贴纸书 3-6岁 贴画儿童 贴画书全套12册 贴画 贴纸儿童 汽</div>
                        </div>
                        <div class="p-price">￥24.80</div>
                        <div class="p-num">
                            <div class="quantity-form">
                                <a href="javascript:;" class="decrement">-</a>
                                <input type="text" class="itxt" value="1">
                                <a href="javascript:;" class="increment">+</a>
                            </div>
                        </div>
                        <div class="p-sum">￥24.80</div>
                        <div class="p-action"><a href="javascript:;">删除</a></div>
                    </div>
                    <div class="cart-item">
                        <div class="p-checkbox">
                            <input type="checkbox" name="" id="" class="s-checkbox">
                        </div>
                        <div class="p-goods">
                            <div class="p-img">
                                <img src="upload/p3.jpg" alt="">
                            </div>
                            <div class="p-msg">唐诗三百首+成语故事全2册 一年级课外书 精装注音儿童版 小学生二三年级课外阅读书籍</div>
                        </div>
                        <div class="p-price">￥29.80</div>
                        <div class="p-num">
                            <div class="quantity-form">
                                <a href="javascript:;" class="decrement">-</a>
                                <input type="text" class="itxt" value="1">
                                <a href="javascript:;" class="increment">+</a>
                            </div>
                        </div>
                        <div class="p-sum">￥29.80</div>
                        <div class="p-action"><a href="javascript:;">删除</a></div>
                    </div>
                </div>

                <!-- 结算模块 -->
                <div class="cart-floatbar">
                    <div class="select-all">
                        <input type="checkbox" name="" id="" class="checkall">全选
                    </div>
                    <div class="operation">
                        <a href="javascript:;" class="remove-batch"> 删除选中的商品</a>
                        <a href="javascript:;" class="clear-all">清理购物车</a>
                    </div>
                    <div class="toolbar-right">
                        <div class="amount-sum">已经选<em>1</em>件商品</div>
                        <div class="price-sum">总价： <em>￥12.60</em></div>
                        <div class="btn-area">去结算</div>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <script>
        // decrement -
        // increment+
        $(function() {
            $('.checkall').change(function() {
                    $('.s-checkbox, .checkall').prop('checked',$(this).prop('checked'))
                    getSum()
                    // 当全选按钮被点击了 背景色都变化
                    if($(this).prop('checked')) {
                        // $('.cart-item').css('background','#fff4e8')
                        $('.cart-item').addClass('check-cart-item')
                    } else {
                        // $('.cart-item').css('background','#fff')
                        $('.cart-item').removeClass('check-cart-item')
                    }
            })
            // 如果小复选框被选中的个数等于3 就应该把全选按钮选上，否则全选按钮不选
            $('.s-checkbox').change(function() {
                // if (被选中的小的复选框个数 == 3) {
                //     就选中全选框按钮
                // } else {
                //     不要选中全选按钮
                // }
                //    :checked  就是用来查看当前有几个被选中的复选框的 length是长度
                //   $('.checkall').length  就是所有小复选框的个数
                if ($('.s-checkbox:checked').length === $('.s-checkbox').length) {
                    $('.checkall').prop('checked',true)
                }else {
                    $('.checkall').prop('checked',false)
                }
                // 当前按钮被点击了，当前背景颜色改变
                if($(this).prop('checked')) {
                    // $(this).parents('.cart-item').css('background','#fff4e8')
                    $(this).parents('.cart-item').addClass('check-cart-item')
                } else {
                    // $(this).parents('.cart-item').css('background','#fff')
                    $(this).parents('.cart-item').removeClass('check-cart-item')
                }
                getSum()
            })
            // 3.增减商品数量模块，先声明一个变量 当点击加号 让index++ 然后赋值给文本框，点击减号同理
            $('.increment').click(function() {
                // toFixed(保留两位小数)
                var index = $(this).siblings('input').val()
                index++
                $(this).siblings('input').val(index)
                // 4.修改商品小计模块
                // 核心思路：每次点击 + 或者 - 根据文本框的值 乘以当前商品的价格 就是商品的小计
                // 注意1：只能增加本商品的小计，就是当前商品的小计模块(p-sum)
                // 修改普通元素的内容是text()
                // 注意2： 当前商品的价格，要把￥符号去掉再相乘，截取字符 substr(1) 意思是从第一个字符开始截取到最后一个，这样就正好把单位符号去掉了
                // var expense = $(this).parent().parent().siblings('.p-price').text().substr(1)
                var expense = $(this).parents('.p-num').siblings('.p-price').text().substr(1)
                // 设置一个变量 expense 当前元素的父亲的父亲的兄弟元素的值拿出来，再截取元素
                expense = (index * expense).toFixed(2)  // 用拿到的值 乘以当前 index 值 就是小计 然后保留两位小数
                $(this).parents('.p-num').siblings('.p-sum').text('￥'+expense) // 最后输出内容

                getSum()  // 如果增加了个数 就重新刷新下值  函数在下面
            })
            $('.decrement').click(function() {
                var index = $(this).siblings('input').val() 
                var expense = $(this).parents('.p-num').siblings('.p-price').text().substr(1,5)
                console.log(expense);
                // 必须让他得到当前兄弟的输入框的值，如果在外面设置一个变量，则会影响全部
                index--
                if (index < 1 ) {
                    index = 1 
                }
                expense = (index * expense).toFixed(2) // 保留两位小数
                $(this).siblings('input').val(index)
                $(this).parents('.p-num').siblings('.p-sum').html('￥'+ expense)

                getSum()  // 如果减少了个数 就重新刷新下值  函数在下面
            })
            // 4.用户修改文本框的值 计算 小计模块
            $('.itxt').change(function() {
                // 先得到文本框里面的值 乘以 当前商品的单价
                var index = $(this).val()
                // 当前商品单价
                var expense = $(this).parents('.p-num').siblings('.p-price').text().substr(1)
                expense = (index * expense).toFixed(2)  // 用拿到的值 乘以当前 index 值 就是小计 然后保留两位小数
                $(this).parents('.p-num').siblings('.p-sum').text('￥'+expense) // 最后输出内容

                getSum() // 修改了 文本框的值，就更新下数据
            })
            // 5.结算模块 计算总价格
            // 核心思路：把所有文本框里面的值相加就是总计数量，总额同理
            // 文本框里面的值不同，如果想要相加需要用到each遍历，声明一个变量，相加即可
            // 点击+号-号，会改变总计和总额，如果用户修改了文本框里面的值同样也会改变总计和总额
            // 因此可以封装一个函数求总计和总额，以上2个操作调用这个函数即可
            // 注意1：总计是文本框里面的值相加用 val() 总额是普通元素的内容用 text()
            // amount-sum
            // price-sum
            // p-sum
            // itxt
            // var priceSum = 0
            // var quantitySum = 0
            // $('.p-sum').each(function(i,ele) {
            //     priceSum += $(ele).text().substr(1) - 0
            // })
            // $('.itxt').each(function(i,ele) {
            //     quantitySum += $(ele).val() - 0
            // })
            // // $.each($('.p-sum'),function(i,ele) {
                
            // //     // console.log(expense);
            // //     priceSum += $(ele).text().substr(1) - 0  // 转换为数字型
            // // })
            
            // // $.each($('.itxt'),function(i,ele) {
            // //     quantitySum += $(ele).val() - 0
            // // })
            // $('.amount-sum em').text(quantitySum)
            // $('.price-sum em').text('￥'+priceSum)

            getSum()  // 最后在遍历一次数据 做总结 求总和
                // 5.结算模块 计算总价格
            // 核心思路：把所有文本框里面的值相加就是总计数量，总额同理
            // 文本框里面的值不同，如果想要相加需要用到each遍历，声明一个变量，相加即可
            // 点击+号-号，会改变总计和总额，如果用户修改了文本框里面的值同样也会改变总计和总额
            // 因此可以封装一个函数求总计和总额，以上2个操作调用这个函数即可
            // 注意1：总计是文本框里面的值相加用 val() 总额是普通元素的内容用 text()
            // 封装函数的话，可以很多代码重复，因为每次增加和减少，文本框内改数值，都会让数据改变，
            // 要是想让数据跟着变的话，需要每个过程都遍历一次，代码冗余太严重，
            // 所以封装函数，在他那个位置直接放上函数就方便很多
            function getSum() {
            var count = 0  // 总件数
            var money = 0  // 总额
            $('.itxt').each(function(i,ele) {
                count += $(ele).val() - 0
            })
            $('.amount-sum em').text(count)
            $('.p-sum').each(function(i,ele) {
                money += $(ele).text().substr(1) - 0
            })
            $('.price-sum em').text('￥'+money.toFixed(2))
        }
        // 6.删除商品模块
        // 核心思路：把商品remove() 删除元素即可
        //  有三个地方需要删除： 1.商品后面的删除按钮，2.删除选中的商品 3.清理购物车
        // p-action
        // remove-batch
        // clear-all
        // 删除当前商品
        $('.p-action a').click(function() {
            $(this).parents('.cart-item').remove() 
            getSum() 
        })
        // 删除选中的商品
        $('.remove-batch').click(function() {
            // 删除小的复选框选中的商品
            $('.s-checkbox:checked').parents('.cart-item').remove()  
            getSum()
        })
        // 清空购物车
        $('.clear-all').click(function() {
            $('.cart-item').remove()  
            getSum()
        })
        // 7.选中商品添加背景颜色
        // 直接写在复选框里面去了
        // $('.s-checkbox').change(function() {
        //     if($(this).prop('checked')) {
        //         $(this).parents('.cart-item').css('background','#fff4e8')
        //     } else {
        //         $(this).parents('.cart-item').css('background','#fff')
        //     }
        // })
        })
        

    </script>
</body>
</html>